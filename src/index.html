<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
  <title>Blockly Demo: Elevators</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- link in framework javascripts -->
  <script type="text/javascript" src="js/underscore-min.js"></script>
  <script type="text/javascript" src="js/phaser.min.js"></script>
  <script type="text/javascript" src="js/EventEmitter.min.js"></script>
  <script type="text/javascript" src="js/nanoajax.min.js"></script>
  <script type="text/javascript" src="js/blockly_compressed.js"></script>
  <script type="text/javascript" src="js/blocks_compressed.js"></script>
  <script type="text/javascript" src="js/javascript_compressed.js"></script>
  <script type="text/javascript" src="js/en.js"></script>
  <!-- link in application javascripts -->
  <script type="text/javascript" src="js/constants.js"></script>
  <script type="text/javascript" src="js/game.js"></script>
  <script type="text/javascript" src="js/displayinit.js"></script>
  <script type="text/javascript" src="js/floormanager.js"></script>
  <script type="text/javascript" src="js/personmanager.js"></script>
  <script type="text/javascript" src="js/controller.js"></script>
  <script type="text/javascript" src="js/rungame.js"></script>
</head>
<body>
  <table>
    <tr>
      <td colspan=2>
        <h1>
          <span id="title">This is a demo of programming an elevator using <a href="https://developers.google.com/blockly/">Blockly</a>.</span> &nbsp;
          <a id="level1" href="?level=1"></a>
          <span id="level1s">1</span>
          <a id="level2" href="?level=2"></a>
          <span id="level2s">2</span>
          <a id="level3" href="?level=3"></a>
          <span id="level3s">3</span>
          <a id="level4" href="?level=4"></a>
          <span id="level4s">4</span>
        </h1>
      </td>
    </tr>
    <tr>
      <td>
        <button id="runButton">Run Code</button>
        <button id="resetButton" style="display:none">Reset</button>
      </td>
      <td>
        <button id="viewButton">Show Code</button>
      </td>
    </tr>
    <tr>
      <td>
        <div id="gamepanel" style="width: 500px">
        </div>
      </td>
      <td>
        <div id="blocklyDiv" style="height: 800px"></div>
      </td>
    </tr>
    <tr>
      <td>
        <a href="https://github.com/proneel/blockly-elev/blob/master/attributions.md">Attribution for GameArt and JS Libraries</a>
      </td>
    </tr>
  </table>

  <script>
// for browsers where the window.console is unavailable
if(!window.console){ window.console = {log: function(){} }; } 

var game = null;
var level = 1; // default

// on window load
__initialize = function() {
    // display the correct level
    l = window.location.search.match('level=[0-9]+');
    if (l != null) {
        level = Number(l[0].substring(6));
        if (level < 1 || level > 4) level = 1;
    }
    
    for (i = 1; i <= 4; ++i) {
        if (i == level) {
            document.getElementById('level'+i).className = "level_dot invisible";
            document.getElementById('level'+i+'s').className = "level_number level_done visible";
        } else {
            document.getElementById('level'+i).className = "level_dot visible";
            document.getElementById('level'+i+'s').className = "level_number level_done invisible";
        }
    }

    // create a phaser where the elevator game will be displayed
    game = new Phaser.Game(__c_.maxX, __c_.maxY(), Phaser.AUTO, 'gamepanel', { preload: DisplayInit.preLoad, create: DisplayInit.create, update: DisplayInit.update });
    // initialize Blockly
    ElevGame.initBlockly();
}

/**
 * Force Blockly to resize into the available width.
 */
__resize = function() {
    var width = Math.max(window.innerWidth - 600, 250);
    document.getElementById('blocklyDiv').style.width = width + 'px';
};

document.getElementById('runButton').addEventListener('click', function() {
    document.getElementById('resetButton').style.display = 'block';
    document.getElementById('runButton').style.display = 'none';
    ElevGame.runJS();
});

document.getElementById('resetButton').addEventListener('click', function() {
    document.getElementById('resetButton').style.display = 'none';
    document.getElementById('runButton').style.display = 'block';
    ElevGame.reset();
});

document.getElementById('viewButton').addEventListener('click', ElevGame.showCode);

window.addEventListener('load', __initialize);
window.addEventListener('resize', __resize);

  </script>

</body>
</html>
